#!/bin/bash

# API Integration Specialist - Specialized Context Loading Script
# Loads API documentation, rate limits, and integration patterns

echo "ğŸ”Œ API INTEGRATION SPECIALIST - Loading API context..."
echo "===================================================="

PROJECT_ROOT="/Users/tmk/Documents/prophet-growth-analysis"

# Phase 1: API Architecture Overview
echo "ğŸ—ï¸ Phase 1: API Architecture Context..."
echo ""
echo "âœ… Current API Stack:"
echo "   â†’ Next.js 15 App Router API Routes"
echo "   â†’ RESTful design patterns"
echo "   â†’ Zod schema validation"
echo "   â†’ TypeScript end-to-end type safety"
echo "   â†’ Direct API integrations (no complex orchestration)"
echo ""

# Phase 2: External API Integrations
echo "ğŸŒ Phase 2: External APIs Configuration..."
echo ""
echo "âœ… Anthropic Claude API:"
echo "   â†’ Model: claude-3-5-sonnet-20241022"
echo "   â†’ Rate Limits: 50 requests/minute"
echo "   â†’ Max tokens: 4096 per request"
echo "   â†’ Streaming support available"
echo "   â†’ Context window: 200K tokens"
echo ""
echo "âœ… ElevenLabs Voice API:"
echo "   â†’ Voice synthesis endpoint"
echo "   â†’ Multiple voice options"
echo "   â†’ Audio format: MP3/WAV"
echo "   â†’ Streaming audio support"
echo "   â†’ SSML markup supported"
echo ""

# Phase 3: API Route Structure
echo "ğŸ“ Phase 3: API Routes Organization..."
echo ""
echo "âœ… Current API Endpoints:"
echo "   â†’ /api/auth/* - Authentication endpoints"
echo "   â†’ /api/chat - Claude AI integration"
echo "   â†’ /api/voice - ElevenLabs synthesis"
echo "   â†’ /api/analyze - Financial analysis"
echo "   â†’ /api/forecast - Prophet predictions"
echo "   â†’ /api/employees - Employee management"
echo ""

# Phase 4: Request/Response Patterns
echo "ğŸ“¨ Phase 4: API Design Patterns..."
echo ""
echo "âœ… Request Validation:"
echo "   â†’ Use Zod schemas for all inputs"
echo "   â†’ TypeScript types from schemas"
echo "   â†’ Consistent error responses"
echo "   â†’ Request body size limits"
echo ""
echo "âœ… Response Standards:"
echo "   â†’ Consistent JSON structure"
echo "   â†’ Proper HTTP status codes"
echo "   â†’ Error handling with details"
echo "   â†’ Pagination for lists"
echo ""

# Phase 5: Authentication Patterns
echo "ğŸ” Phase 5: API Authentication..."
echo ""
echo "âœ… Auth Implementation:"
echo "   â†’ JWT tokens in Authorization header"
echo "   â†’ Bearer token format"
echo "   â†’ Token refresh endpoints"
echo "   â†’ API key management for services"
echo ""

# Phase 6: Rate Limiting Strategy
echo "âš¡ Phase 6: Rate Limiting Configuration..."
echo ""
echo "âœ… Rate Limit Tiers:"
echo "   â†’ Public endpoints: 20 req/min"
echo "   â†’ Authenticated: 100 req/min"
echo "   â†’ AI endpoints: 50 req/min"
echo "   â†’ Implement exponential backoff"
echo "   â†’ Return rate limit headers"
echo ""

# Phase 7: Error Handling Patterns
echo "â— Phase 7: Error Handling Standards..."
echo ""
echo "âœ… Error Response Format:"
echo "```json"
echo "{"
echo "  \"error\": {"
echo "    \"code\": \"VALIDATION_ERROR\","
echo "    \"message\": \"Invalid input data\","
echo "    \"details\": {}"
echo "  }"
echo "}"
echo "```"
echo ""
echo "âœ… Common Error Codes:"
echo "   â†’ 400 - Bad Request (validation)"
echo "   â†’ 401 - Unauthorized"
echo "   â†’ 403 - Forbidden"
echo "   â†’ 404 - Not Found"
echo "   â†’ 429 - Rate Limited"
echo "   â†’ 500 - Server Error"
echo ""

# Phase 8: API Testing Tools
echo "ğŸ§ª Phase 8: API Testing Context..."
echo ""
echo "âœ… Testing Commands:"
echo "   â†’ curl - Quick endpoint tests"
echo "   â†’ httpie - User-friendly HTTP client"
echo "   â†’ Postman - Comprehensive testing"
echo "   â†’ Jest - Automated API tests"
echo ""

# Phase 9: Performance Optimization
echo "ğŸš€ Phase 9: API Performance Tips..."
echo ""
echo "âœ… Optimization Strategies:"
echo "   â†’ Response caching with proper headers"
echo "   â†’ Database connection pooling"
echo "   â†’ Async/await for all operations"
echo "   â†’ Minimize payload sizes"
echo "   â†’ Use streaming for large responses"
echo ""

# Context Summary
echo "ğŸ¯ API INTEGRATION SPECIALIST CONTEXT LOADED"
echo "===================================================="
echo "âœ… API Architecture: Understood"
echo "âœ… External APIs: Configured"
echo "âœ… Rate Limits: Known"
echo "âœ… Error Patterns: Standardized"
echo "âœ… Ready to build robust API integrations!"
echo "===================================================="